/*******************************************************************************
 * Educational Online Test Delivery System 
 * Copyright (c) 2014 American Institutes for Research
 *   
 * Distributed under the AIR Open Source License, Version 1.0 
 * See accompanying file AIR-License-1_0.txt or at
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/
package org.opentestsystem.unittest.db.export;

import java.io.File;
import java.nio.file.Path;
import java.nio.file.Paths;

import org.apache.commons.io.FileUtils;

public class MyContentUploader
{
  private final static String upzippedDirectory   = "C:/Scratch/assessment/MN_PT-03-2013-2014_config4073_GRADSamplers/";
  // must coincide with itembank.tblclient.homepath column
  private final static String destClientDirectory = "C:/temp/";
  private static final String bankNumber          = "159";

  public static void main (String... aArgs) throws Exception {
    final File folder = new File (upzippedDirectory);
    for (File fileEntry : folder.listFiles ()) {
      if (fileEntry.isFile ()) {
        String fileName = fileEntry.getName ();
        if (fileName.startsWith ("Item")) {

          String parts[] = fileName.split ("_");
          String tblItemFileDir = new StringBuilder (destClientDirectory).append ("Bank-").append (bankNumber).
              append ("/Items/").append ("Item-").append (bankNumber).append ("-").append (parts[1]).append ("/").
              toString ();
          if (fileName.endsWith (".xml")) {
            // this is an item itself, for example: Item_44_v2.xml
            String tblItemFileName = new StringBuilder ("item-").append (bankNumber).append ("-").append (parts[1]).
                append (".xml").toString ();
            String tblItemFilePath = new StringBuilder (tblItemFileDir).append (tblItemFileName).toString ();
            Path path = Paths.get (tblItemFilePath);
            File tmp = new File (path.toString ());
            tmp.getParentFile ().mkdirs ();

            FileUtils.copyFile (fileEntry, tmp);
            System.out.println("Created item file " + tmp.getName());
          } else {
            // this is a resource file,for example:
            // Item_44_v2_Object2_png16malpha.png
            String tblItemFilePath = new StringBuilder (tblItemFileDir).append (fileName).toString ();
            Path path = Paths.get (tblItemFilePath);
            File tmp = new File (path.toString ());
            tmp.getParentFile ().mkdirs ();

            FileUtils.copyFile (fileEntry, tmp);
            System.out.println("Created item resource file " + tmp.getName());
          }
        } else if (fileName.startsWith ("Passage")) {
          // this is a stimulus itself, for example: Passage_2_v15.xml
          String parts[] = fileName.split ("_");
          String tblItemFileDir = new StringBuilder (destClientDirectory).append ("Bank-").append (bankNumber).
              append ("/Stimuli/").append ("Stim-").append (bankNumber).append ("-").append (parts[1]).append ("/").
              toString ();
          if (fileName.endsWith (".xml")) {
            
            String tblItemFileName = new StringBuilder ("stim-").append (bankNumber).append ("-").append (parts[1]).
                append (".xml").toString ();
            String tblItemFilePath = new StringBuilder (tblItemFileDir).append (tblItemFileName).toString ();
            Path path = Paths.get (tblItemFilePath);
            File tmp = new File (path.toString ());
            tmp.getParentFile ().mkdirs ();

            FileUtils.copyFile (fileEntry, tmp);
            System.out.println("Created stimulus file " + tmp.getName());
          }
        }
      }
    }
  }

}
